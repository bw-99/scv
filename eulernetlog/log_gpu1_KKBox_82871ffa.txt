2025-05-14 22:00:35,089 P2310307 INFO FuxiCTR version: 2.3.3
2025-05-14 22:00:35,089 P2310307 INFO Params: {
    "batch_norm": "True",
    "batch_size": "10000",
    "cold_dim": "10",
    "cold_tau": "0.008",
    "data_format": "csv",
    "data_root": "dataset/",
    "dataset_id": "KKBox_x1",
    "debug_mode": "False",
    "early_stop_patience": "2",
    "embedding_dim": "128",
    "embedding_regularizer": "0.0005",
    "epochs": "100",
    "eval_steps": "None",
    "experiment_id": "AdaGIN_KKBox_x1",
    "feature_cols": "[{'active': True, 'dtype': 'str', 'name': ['msno', 'song_id', 'source_system_tab', 'source_screen_name', 'source_type', 'city', 'gender', 'registered_via', 'language'], 'type': 'categorical'}, {'active': True, 'dtype': 'str', 'encoder': 'MaskedSumPooling', 'max_len': 3, 'name': 'genre_ids', 'type': 'sequence'}, {'active': True, 'dtype': 'str', 'encoder': 'MaskedSumPooling', 'max_len': 3, 'name': 'artist_name', 'type': 'sequence'}, {'active': True, 'dtype': 'str', 'name': 'isrc', 'preprocess': 'extract_country_code', 'type': 'categorical'}, {'active': True, 'dtype': 'str', 'name': 'bd', 'preprocess': 'bucketize_age', 'type': 'categorical'}]",
    "feature_config": "None",
    "feature_specs": "None",
    "fi_hidden_units": "[400, 400, 400]",
    "gnn_layers": "1",
    "gpu": "1",
    "group_id": "None",
    "label_col": "{'dtype': 'float', 'name': 'label'}",
    "learning_rate": "0.001",
    "loss": "binary_crossentropy",
    "mask_rate": "0",
    "metrics": "['logloss', 'AUC']",
    "min_categr_count": "10",
    "model": "AdaGIN",
    "model_id": "AdaGIN_KKBox_x1",
    "model_root": "./checkpoints/",
    "monitor": "{'AUC': 1, 'logloss': 0}",
    "monitor_mode": "max",
    "net_dropout": "0.2",
    "num_workers": "16",
    "optimizer": "adam",
    "pickle_feature_encoder": "True",
    "save_best_only": "True",
    "save_feature_interaction": "0",
    "seed": "2024",
    "task": "binary_classification",
    "test_data": "dataset/KKBox_x1/test.csv",
    "train_data": "dataset/KKBox_x1/train.csv",
    "use_features": "None",
    "valid_data": "dataset/KKBox_x1/valid.csv",
    "verbose": "1",
    "w_hidden_units": "[400, 400, 400]",
    "warm_dim": "10",
    "warm_tau": "1.15"
}
2025-05-14 22:00:35,089 P2310307 INFO Set up feature processor...
2025-05-14 22:00:35,089 P2310307 WARNING Skip rebuilding dataset/KKBox_x1/feature_map.json. Please delete it manually if rebuilding is required.
2025-05-14 22:00:35,089 P2310307 INFO Load feature_map from json: dataset/KKBox_x1/feature_map.json
2025-05-14 22:00:35,090 P2310307 INFO Set column index...
2025-05-14 22:00:35,090 P2310307 INFO Feature specs: {
    "artist_name": "{'source': '', 'type': 'sequence', 'feature_encoder': 'layers.MaskedAveragePooling()', 'padding_idx': 0, 'max_len': 3, 'vocab_size': 11976}",
    "bd": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'vocab_size': 9}",
    "city": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'vocab_size': 23}",
    "gender": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'vocab_size': 4}",
    "genre_ids": "{'source': '', 'type': 'sequence', 'feature_encoder': 'layers.MaskedAveragePooling()', 'padding_idx': 0, 'max_len': 3, 'vocab_size': 346}",
    "isrc": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'vocab_size': 80}",
    "language": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'vocab_size': 12}",
    "msno": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'vocab_size': 25963}",
    "registered_via": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'vocab_size': 7}",
    "song_id": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'vocab_size': 53291}",
    "source_screen_name": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'vocab_size': 21}",
    "source_system_tab": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'vocab_size': 10}",
    "source_type": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'vocab_size': 14}"
}
/home/dxlab/jupyter/jinhee/scv/.venv/lib/python3.9/site-packages/fuxictr/pytorch/models/rank_model.py:65: UserWarning: mods argument is not needed anymore, you can stop passing it
  self.flop_counter = FlopCounterMode(mods=self, display=False, depth=None)
2025-05-14 22:00:36,456 P2310307 INFO Total number of parameters: 24625723.
2025-05-14 22:00:36,456 P2310307 INFO Loading datasets...
2025-05-14 22:00:52,036 P2310307 INFO Train samples: total/5901932, blocks/1
2025-05-14 22:00:54,891 P2310307 INFO Validation samples: total/737743, blocks/1
2025-05-14 22:00:54,891 P2310307 INFO Loading train and validation data done.
2025-05-14 22:00:54,891 P2310307 INFO Start training: 591 batches/epoch
2025-05-14 22:00:54,891 P2310307 INFO ************ Epoch=1 start ************
remove_modelremove_modelremove_modelremove_modelremove_modelremove_modelremove_modelremove_modelremove_modelremove_model True
**************
./config/ AdaGIN_KKBox_x1
**************
AdaGIN_KKBox_x1
*******************
dataset/KKBox_x1
fucking {'active': True, 'dtype': 'str', 'name': ['msno', 'song_id', 'source_system_tab', 'source_screen_name', 'source_type', 'city', 'gender', 'registered_via', 'language'], 'type': 'categorical'}
fucking {'active': True, 'dtype': 'str', 'encoder': 'MaskedSumPooling', 'max_len': 3, 'name': 'genre_ids', 'type': 'sequence'}
fucking {'active': True, 'dtype': 'str', 'encoder': 'MaskedSumPooling', 'max_len': 3, 'name': 'artist_name', 'type': 'sequence'}
fucking {'active': True, 'dtype': 'str', 'name': 'isrc', 'preprocess': 'extract_country_code', 'type': 'categorical'}
fucking {'active': True, 'dtype': 'str', 'name': 'bd', 'preprocess': 'bucketize_age', 'type': 'categorical'}
  0%|          | 0/591 [00:00<?, ?it/s]  0%|          | 0/591 [00:01<?, ?it/s]
Traceback (most recent call last):
  File "/home/dxlab/jupyter/jinhee/scv/run_expid.py", line 120, in <module>
    model.fit(train_gen, validation_data=valid_gen, **params)
  File "/home/dxlab/jupyter/jinhee/scv/.venv/lib/python3.9/site-packages/fuxictr/pytorch/models/rank_model.py", line 189, in fit
    self.train_epoch(data_generator)
  File "/home/dxlab/jupyter/jinhee/scv/.venv/lib/python3.9/site-packages/fuxictr/pytorch/models/rank_model.py", line 251, in train_epoch
    loss = self.train_step(batch_data)
  File "/home/dxlab/jupyter/jinhee/scv/.venv/lib/python3.9/site-packages/fuxictr/pytorch/models/rank_model.py", line 232, in train_step
    return_dict = self.forward(batch_data)
  File "/home/dxlab/jupyter/jinhee/scv/src/model_zoo/AdaGIN/src/AdaGIN.py", line 113, in forward
    return self.forward_real(inputs)
  File "/home/dxlab/jupyter/jinhee/scv/src/model_zoo/AdaGIN/src/AdaGIN.py", line 128, in forward_real
    h_list = self.AutoGraph(feature_emb)
  File "/home/dxlab/jupyter/jinhee/scv/.venv/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/dxlab/jupyter/jinhee/scv/.venv/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dxlab/jupyter/jinhee/scv/src/model_zoo/AdaGIN/src/AdaGIN.py", line 218, in forward
    return self.forward_real(feature_emb)
  File "/home/dxlab/jupyter/jinhee/scv/src/model_zoo/AdaGIN/src/AdaGIN.py", line 250, in forward_real
    cold_matrix = self.build_cold_matrix(h, self.cold_tau)
  File "/home/dxlab/jupyter/jinhee/scv/src/model_zoo/AdaGIN/src/AdaGIN.py", line 203, in build_cold_matrix
    emb1 = torch.index_select(feature_emb, 1, self.all_node_index[0])
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 826.00 MiB. GPU 1 has a total capacity of 23.65 GiB of which 238.94 MiB is free. Process 2271464 has 2.95 GiB memory in use. Process 2290581 has 19.84 GiB memory in use. Including non-PyTorch memory, this process has 626.00 MiB memory in use. Of the allocated memory 161.19 MiB is allocated by PyTorch, and 18.81 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
